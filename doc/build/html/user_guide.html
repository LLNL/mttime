

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User Guide &mdash; tdmtpy 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/OS-icon-color.png"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="reference/api.html" />
    <link rel="prev" title="Getting started" href="getting_started.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/OS-logo-horizontal-white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dataset">Dataset</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#directory-and-file-structures">Directory and file structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#waveform-data">Waveform Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#synthetic-seismograms">Synthetic Seismograms</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#output-files">Output Files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference/api.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">tdmtpy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>User Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/user_guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-guide">
<span id="id1"></span><h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<p>The user guide covers the inverse routine and file structure. Users brand new
to moment tensor inversion should check out the Jupyter Notebook
<a class="reference external" href="https://github.com/LLNL/tdmtpy/tree/master/examples/notebooks">tutorials</a>
for an complete example that includes data processing and synthetics calculation.</p>
<p>Further information on any specific method can be obtained in the API reference.</p>
<div class="section" id="basics">
<h2>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<p>The inverse routine is divided into three main parts:</p>
<ol class="arabic simple">
<li><p>Parsing an input file to get a set of parameters required to run the inversion.</p></li>
<li><p>Perform the inversion based on the parameters provided.</p></li>
<li><p>Write the results to file.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># import the package</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tdmtpy</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 1. read input file and set up the inversion</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="n">tdmtpy</span><span class="o">.</span><span class="n">Configure</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="s2">&quot;mtinv.in&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mt</span> <span class="o">=</span> <span class="n">tdmtpy</span><span class="o">.</span><span class="n">Inversion</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 2. Run inversion and plot the result (if plotting function is turned on)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mt</span><span class="o">.</span><span class="n">invert</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 3. Save result to file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mt</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</pre></div>
</div>
<p>We will go over the details in the following sections.</p>
</div>
<div class="section" id="dataset">
<span id="id2"></span><h2>Dataset<a class="headerlink" href="#dataset" title="Permalink to this headline">¶</a></h2>
<p>In this section we will introduce the file structure and input parameters using an example.
The earthquake in this example occured near Byron, California on July 16, 2019. The raw data
and instrument response were obtained from the <a class="reference external" href="https://ds.iris.edu/ds/nodes/dmc/">IRIS DMC</a>
using ObsPy’s <a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.clients.fdsn.mass_downloader.html">mass_downloader functionality</a>.</p>
<div class="section" id="directory-and-file-structures">
<h3>Directory and file structures<a class="headerlink" href="#directory-and-file-structures" title="Permalink to this headline">¶</a></h3>
<p>In this example all of the files (input, data and synthetics) are assumed to be located under
a single root directory called <strong>project</strong>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>project
|    mtinv.in
|
|____40191336
|    |  BK.QRDG.00.z.dat
|    |  BK.RUSS.00.z.dat
|    |  ...
|
|____40191336/gil7
     |  BK.QRDG.00.12.0000.ZDD
     |  BK.QRDG.00.12.0000.ZDS
     |  ...
</pre></div>
</div>
<p>Under project there is the input parameter file <strong>mtinv.in</strong> which contains
headers and a station table:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>datetime       2019-07-16T20:11:01.470000Z
longitude      -121.7568
latitude       37.8187
depth          10,12,20
path_to_data   40191336
path_to_green  40191336/gil7
green          herrmann
components     ZRT
degree         5
weight         distance
plot           1
correlate      0
    station  distance  azimuth  ts  npts   dt  used  longitude  latitude
 BK.QRDG.00     80.99   335.29  31   150 1.00     1    -122.14     38.48
 BK.RUSS.00     81.16   353.18  32   100 1.00     1    -121.87     38.54
  BK.CVS.00     84.88   313.73  31   100 1.00     1    -122.46     38.35
 BK.OAKV.00     88.89   320.02  30   100 1.00     1    -122.41     38.43
 BK.FARB.00    110.46   263.41  30   100 1.00     1    -123.00     37.70
  BK.SAO.00    120.23   166.71  31   150 1.00     1    -121.45     36.76
  BK.CMB.00    122.83    78.33  30   150 1.00     1    -120.39     38.03
 BK.MNRC.00    132.06   333.21  32   150 1.00     1    -122.44     38.88
</pre></div>
</div>
<p>When you call the <a class="reference internal" href="reference/autogen/tdmtpy.configure.Configure.html#tdmtpy.configure.Configure" title="tdmtpy.configure.Configure"><code class="xref py py-class docutils literal notranslate"><span class="pre">Configure</span></code></a> object it will parse the input
text file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="n">tdmtpy</span><span class="o">.</span><span class="n">Configure</span><span class="p">(</span><span class="n">path_to_file</span><span class="o">=</span><span class="s2">&quot;mtinv.in&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The headers have two columns: a parameter name and its corresponding value. If the values are left blank,
the default values will be used instead. A descrption of the parameters are shown here:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 87%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>parameters</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>path_to_file</p></td>
<td><p>path to input file containing headers and station information.
Directory will become the project root directory. Default is <code class="docutils literal notranslate"><span class="pre">&quot;./mtinv.in&quot;</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>datetime</p></td>
<td><p>event origin time, optional.</p></td>
</tr>
<tr class="row-even"><td><p>longitude</p></td>
<td><p>event longitude, optional.</p></td>
</tr>
<tr class="row-odd"><td><p>latitude</p></td>
<td><p>event latitude, optional.</p></td>
</tr>
<tr class="row-even"><td><p>depth</p></td>
<td><p>source depths to invert.</p></td>
</tr>
<tr class="row-odd"><td><p>path_to_data</p></td>
<td><p>path to data files, relative to root directory.
Defaults is <code class="docutils literal notranslate"><span class="pre">&quot;./&quot;</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>path_to_green</p></td>
<td><p>path to Green’s function files, relative to root directory.
Defaults is <code class="docutils literal notranslate"><span class="pre">&quot;./&quot;</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>green</p></td>
<td><p>Green’s function format, options are <code class="docutils literal notranslate"><span class="pre">&quot;herrmann&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;tensor&quot;</span></code>.
Defaults to <code class="docutils literal notranslate"><span class="pre">&quot;herrmann&quot;</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>components</p></td>
<td><p>waveform components, options are <code class="docutils literal notranslate"><span class="pre">&quot;Z&quot;</span></code> for vertical component,
or <code class="docutils literal notranslate"><span class="pre">&quot;ZRT&quot;</span></code> for three-component data in vertical, radial and transverse components.
Defaults to <code class="docutils literal notranslate"><span class="pre">&quot;ZRT&quot;</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>degree</p></td>
<td><p>degrees of freedom allowed in the inversion, options are <code class="docutils literal notranslate"><span class="pre">5</span></code> for deviatoric
or <code class="docutils literal notranslate"><span class="pre">6</span></code> for full. Defaults to <code class="docutils literal notranslate"><span class="pre">5</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>weight</p></td>
<td><p>data weights, options are <code class="docutils literal notranslate"><span class="pre">&quot;none&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;distance&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;variance&quot;</span></code>
for no weights, inverse distance, or inverse variance, respectively.
Defaults to <code class="docutils literal notranslate"><span class="pre">&quot;none&quot;</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>plot</p></td>
<td><p>If <code class="docutils literal notranslate"><span class="pre">True</span></code> will plot the solution and waveform fits. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>correlate</p></td>
<td><p>Flag to cross-correlate data and Green’s functions
for best time shift in time points. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Station table</p>
<p>Lines 13 and onward in <strong>mtinv.in</strong> contain the station information, line 13 is the station header
and should not be modified. A description of the headers is shown here:</p>
<table class="table-striped docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 91%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>headers</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>station</p></td>
<td><p>file names of data and synthetics</p></td>
</tr>
<tr class="row-odd"><td><p>distance</p></td>
<td><p>source-receiver distance</p></td>
</tr>
<tr class="row-even"><td><p>azimuth</p></td>
<td><p>source-receiver azimuth</p></td>
</tr>
<tr class="row-odd"><td><p>ts</p></td>
<td><p>shift data by the number of time points specified</p></td>
</tr>
<tr class="row-even"><td><p>npts</p></td>
<td><p>number of samples to invert</p></td>
</tr>
<tr class="row-odd"><td><p>dt</p></td>
<td><p>sampling interval in seconds</p></td>
</tr>
<tr class="row-even"><td><p>used</p></td>
<td><p>components to invert, set 1 to invert and 0 for prediction only. For three component data
you can set flags for individual components, ordered by ZRT.
e.g. 110 will invert ZR components only</p></td>
</tr>
<tr class="row-odd"><td><p>longitude</p></td>
<td><p>station longitude</p></td>
</tr>
<tr class="row-even"><td><p>latitude</p></td>
<td><p>station latitude</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="waveform-data">
<h3>Waveform Data<a class="headerlink" href="#waveform-data" title="Permalink to this headline">¶</a></h3>
<p>tdmtpy expects both observed and synthetic Green’s functions to be fully processed.
This means they are corrected for instrument response, filtered, and decimated,
and saved as SAC binary files.</p>
<p>The data file names have the following format:</p>
<p>[<code class="docutils literal notranslate"><span class="pre">station</span></code>].[<code class="docutils literal notranslate"><span class="pre">component</span></code>].dat</p>
<ul class="simple">
<li><p>station: from the station column</p></li>
<li><p>component: Z, R, or T (from the components parameter)</p></li>
</ul>
<p>With the example above the data file names for station BK.CMB.00 are:</p>
<ul class="simple">
<li><p>BK.CMB.00.Z.dat</p></li>
<li><p>BK.CMB.00.R.dat</p></li>
<li><p>BK.CMB.00.T.dat</p></li>
</ul>
</div>
<div class="section" id="synthetic-seismograms">
<h3>Synthetic Seismograms<a class="headerlink" href="#synthetic-seismograms" title="Permalink to this headline">¶</a></h3>
<p>The basis Green’s functions can be combined to create three component time histories for an arbitrarily oriented
point source. As mentioned previously two types of synthetic basis Green’s functions are accepted:
<code class="docutils literal notranslate"><span class="pre">herrmann</span></code> and <code class="docutils literal notranslate"><span class="pre">tensor</span></code>.</p>
<p>The tensor format is pretty straight forward, it consists of the six elementary tensor elements in
cartesian space. north, east and down directions (x, y and z) in Aki and Richards (2002). The herrmann format is
based on the formulation of Herrmann and Wang (1985), which consists of ten fundamental source types.</p>
<p>The synthetic file names have the following format:</p>
<p>[<code class="docutils literal notranslate"><span class="pre">station</span></code>].[<code class="docutils literal notranslate"><span class="pre">depth</span></code>].[<code class="docutils literal notranslate"><span class="pre">green_function_name</span></code>]</p>
<ul class="simple">
<li><p>station: from the station column</p></li>
<li><p>depth: source depth with four significant digits</p></li>
<li><p>component: Z, R, or T (from the components parameter)</p></li>
<li><p>green_function_name: this depends on format of the Green’s functions</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">herrmann</span></code>: TSS, TDS, RSS, RDS, RDD, ZSS, ZDS, ZDD, REC, and ZEX (total of 10)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tensor</span></code>: ZXX, ZYY, ZZZ, ZXY, ZXZ, ZYZ, RXX, etc. (total of 18)</p></li>
</ul>
</li>
</ul>
<p>With the example above the synthetic file names for station BK.CMB.00 are:</p>
<ul class="simple">
<li><p>BK.CMB.00.12.0000.TSS</p></li>
<li><p>BK.CMB.00.12.0000.TDS</p></li>
<li><p>and so on.</p></li>
</ul>
<p>If we change the format to tensor (such that <code class="docutils literal notranslate"><span class="pre">green=&quot;tensor&quot;</span></code>), the file names become:</p>
<ul class="simple">
<li><p>BK.CMB.00.12.0000.TXX</p></li>
<li><p>BK.CMB.00.12.0000.TXY</p></li>
<li><p>and so on.</p></li>
</ul>
</div>
</div>
<div class="section" id="output-files">
<h2>Output Files<a class="headerlink" href="#output-files" title="Permalink to this headline">¶</a></h2>
<p>Running the inversion with the example above will generate the following outputs:</p>
<ul class="simple">
<li><p>Text files:</p>
<ul>
<li><p>d10.0000.mtinv.out - moment tensor solution at 10 km depth</p></li>
<li><p>d12.0000.mtinv.out</p></li>
<li><p>d20.0000.mtinv.out</p></li>
</ul>
</li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Deviatoric Moment Tensor Inversion
Depth = 10.0000 (km)
Mo = 3.006e+22 (dyne-cm)
Mw = 4.29
Percent DC   =  93
Percent CLVD =   7
Percent ISO  =   0
Fault Plane 1: Strike=233 Dip=69 Rake=-6 
Fault Plane 2: Strike=325 Dip=85 Rake=-159
Percent Variance Reduction = 81.78

Moment Tensor Elements: Aki and Richards Cartesian Coordinates
Mxx        Myy        Mzz        Mxy        Mxz        Myz
-2.476e+22 2.750e+22  -2.739e+21 -8.572e+21 7.510e+21  7.411e+21 

GCMT convention (N-m)
Mrr        Mtt        Mpp        Mrt        Mrp        Mtp
-2.739e+14 -2.476e+15 2.750e+15  7.510e+14  -7.411e+14 8.572e+14 

Eigenvalues: 3.006e+22 -1.056e+21
Lune Coordinates: -1.77  0.00  
Station Information
    station  distance  azimuth  ts  npts   dt  Z  R  T weights     VR  longitude  latitude
 BK.QRDG.00     80.99   335.29  31   150  1.0  1  1  1  1.0000  91.80    -122.14     38.48
 BK.RUSS.00     81.16   353.18  32   100  1.0  1  1  1  1.0021  81.54    -121.87     38.54
  BK.CVS.00     84.88   313.73  31   100  1.0  1  1  1  1.0480  77.95    -122.46     38.35
 BK.OAKV.00     88.89   320.02  30   100  1.0  1  1  1  1.0975  52.69    -122.41     38.43
 BK.FARB.00    110.46   263.41  30   100  1.0  1  1  1  1.3639  69.46    -123.00     37.70
  BK.SAO.00    120.23   166.71  31   150  1.0  1  1  1  1.4845  90.68    -121.45     36.76
  BK.CMB.00    122.83    78.33  30   150  1.0  1  1  1  1.5166  73.92    -120.39     38.03
 BK.MNRC.00    132.06   333.21  32   150  1.0  1  1  1  1.6306  86.87    -122.44     38.88
</pre></div>
</div>
<ul class="simple">
<li><p>Figures:</p>
<ul>
<li><p>bbwaves.d10.0000.00.eps - focal mechanism and waveform fits at 10 km depth</p></li>
<li><p>bbwaves.d12.0000.00.eps</p></li>
<li><p>bbwaves.d20.0000.00.eps</p></li>
<li><p>depth.bbmw.eps</p></li>
</ul>
</li>
</ul>
<div class="figure align-default">
<img alt="_images/bbwaves.d10.0000.00.png" src="_images/bbwaves.d10.0000.00.png" />
</div>
<p>Since we performed the inversion at multiple source depths, in addition to the standard
focal mechanism and waveform figures, the plotting function will also generate a figure that
shows the solution as function of source depth.</p>
<div class="figure align-default">
<img alt="_images/depth.bbmw.png" src="_images/depth.bbmw.png" />
</div>
<p>For more details about the plotting function refer to the documentation
<a class="reference internal" href="reference/autogen/tdmtpy.inversion.Inversion.plot.html#tdmtpy.inversion.Inversion.plot" title="tdmtpy.inversion.Inversion.plot"><code class="xref py py-func docutils literal notranslate"><span class="pre">plot</span></code></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="reference/api.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="getting_started.html" class="btn btn-neutral float-left" title="Getting started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Lawrence Livermore National Security, LLC

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>